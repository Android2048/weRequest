/*!
 * weRequest 1.2.0
 * https://github.com/IvinWu/weRequest
 */
module.exports=function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=8)}([function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={sessionName:"session",loginTrigger:function(){return!1},codeToSession:{url:"",success:function(){}},successTrigger:function(){return!0},urlPerfix:"",successData:function(e){return e},doNotCheckSession:!1,errorTitle:"操作失败",errorContent:function(e){return e},reLoginLimit:3,errorCallback:null,reportCGI:!1,mockJson:!1,globalData:!1,sessionExpireKey:"sessionExpireKey"}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={session:"",sessionExpireTime:null,sessionExpire:1/0,sessionIsFresh:!1,logining:!1}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(11),r=o(0),i=o(1),s=o(12),u=o(6),a=o(7),f=o(3),l=o(5),c=o(4),d=o(14);function p(e){var t=this;return"function"==typeof e.beforeSend&&e.beforeSend(),void 0===e.reLoginLimit?e.reLoginLimit=0:e.reLoginLimit++,void 0===e.count&&(e.count=0),e.showLoading&&(n.default.show(e.showLoading),e.complete=function(e){for(var o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];return function(){n.default.hide(),"function"==typeof e&&e.apply.apply(e,[t].concat(o))}}(e.complete)),e.originUrl||(e.originUrl=e.url,e.url=function(e){if(e.startsWith("http"))return e;var t=r.default.urlPerfix;return"function"==typeof r.default.urlPerfix&&(t=r.default.urlPerfix()),t+e}(e.url)),e}function g(){var e={};return"function"==typeof r.default.globalData?e=r.default.globalData():"object"==typeof r.default.globalData&&(e=r.default.globalData),e}function y(e){(e=function(e){var t,o;e.data||(e.data={}),e.originUrl!==r.default.codeToSession.url&&i.default.session&&(e.data=Object.assign({},e.data,((t={})[r.default.sessionName]=i.default.session,t)));var n=g();return e.data=Object.assign({},n,e.data),e.method=e.method||"GET",e.dataType=e.dataType||"json","GET"!==e.method&&(i.default.session&&(e.url=d.default.setParams(e.url,((o={})[r.default.sessionName]=i.default.session,o))),e.url=d.default.setParams(e.url,n)),c.default.start(e),e}(e)).count++,wx.request({url:e.url,data:e.data,method:e.method,header:e.header||{},dataType:e.dataType||"json",success:function(t){l.default(t,e,"request")},fail:function(t){f.default.systemError(e,t),console.error(t)},complete:function(){e.count--,"function"==typeof e.complete&&0===e.count&&e.complete()}})}function m(e){(e=function(e){var t,o;e.formData||(e.formData={}),e.originUrl!==r.default.codeToSession.url&&i.default.session&&(e.formData=Object.assign({},e.formData,((t={})[r.default.sessionName]=i.default.session,t)));var n=g();return e.formData=Object.assign({},n,e.formData),i.default.session&&(e.url=d.default.setParams(e.url,((o={})[r.default.sessionName]=i.default.session,o))),e.url=d.default.setParams(e.url,n),c.default.start(e),e}(e)).count++,wx.uploadFile({url:e.url,filePath:e.filePath||"",name:e.name||"",formData:e.formData,success:function(t){l.default(t,e,"uploadFile")},fail:function(t){f.default.systemError(e,t),console.error(t)},complete:function(){e.count--,"function"==typeof e.complete&&0===e.count&&e.complete()}})}t.default={request:function(e){e=p(e),r.default.mockJson?s.default.get(e,"request"):(e.cache&&u.default.get(e),a.default(function(){y(e)},e))},uploadFile:function(e){e=p(e),r.default.mockJson?s.default.get(e,"uploadFile"):a.default(function(){m(e)},e)}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(0);function r(e,t){wx.showModal({title:e,content:t||"网络或服务异常，请稍后重试",showCancel:!1})}t.default={systemError:function(e,t){r("",t.errMsg),"function"==typeof e.fail&&e.fail("")},logicError:function(e,t){if("function"==typeof e.fail)e.fail(t);else{var o=function(e){var t="";if("function"==typeof n.default.errorTitle)try{t=n.default.errorTitle(e.data)}catch(e){}else"string"==typeof n.default.errorTitle&&(t=n.default.errorTitle);var o="";if("function"==typeof n.default.errorContent)try{o=n.default.errorContent(e.data)}catch(e){}else"string"==typeof n.default.errorContent&&(o=n.default.errorContent);return{title:t,content:o}}(t);r(o.title,o.content)}"function"==typeof n.default.errorCallback&&n.default.errorCallback(e,t),console.error(t)},doError:r}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(0);function r(e,t,o){"function"==typeof n.default.reportCGI&&n.default.reportCGI(e,t,o)}t.default={start:function(e){e._reportStartTime=(new Date).getTime()},end:function(e){e._reportEndTime=(new Date).getTime(),r(e.report,e._reportStartTime,e._reportEndTime)},report:r}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),r=o(1),i=o(2),s=o(3),u=o(6),a=o(4);t.default=function(e,t,o){if(200===e.statusCode){if("string"==typeof e.data)try{e.data=JSON.parse(e.data)}catch(o){return s.default.logicError(t,e),!1}if(a.default.end(t),t.isLogin){var f="";try{f=n.default.codeToSession.success(e.data)}catch(e){}f?t.success(f):s.default.logicError(t,e)}else if(n.default.loginTrigger(e.data)&&t.reLoginLimit<n.default.reLoginLimit)r.default.session="",r.default.sessionIsFresh=!0,wx.removeStorage({key:n.default.sessionName,complete:function(){"request"===o?i.default.request(t):"uploadFile"===o&&i.default.uploadFile(t)}});else if(n.default.successTrigger(e.data)){var l="";try{l=n.default.successData(e.data)}catch(e){console.error("Function successData occur error: "+e)}t.noCacheFlash||"function"==typeof t.success&&t.success(l),u.default.set(t,l)}else s.default.logicError(t,e)}else s.default.logicError(t,e)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={get:function(e){wx.getStorage({key:e.originUrl,success:function(t){"function"==typeof e.cache&&e.cache(t.data)?"function"==typeof e.success&&e.success(t.data,{isCache:!0}):1==e.cache&&"function"==typeof e.success&&e.success(t.data,{isCache:!0}),"function"==typeof e.complete&&e.complete()}})},set:function(e,t){(!0===e.cache||"function"==typeof e.cache&&e.cache(t))&&wx.setStorage({key:e.originUrl,data:t})}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(13),r=o(1),i=o(0),s=o(2),u=o(3),a=o(4);function f(e,t){t.isLogin?"function"==typeof e&&e():r.default.session?r.default.sessionExpireTime&&(new Date).getTime()>r.default.sessionExpire?(r.default.session="",f(e,t)):"function"==typeof e&&e():r.default.logining?n.default.wait("doLoginFinished",function(){f(e,t)}):function(e,t){r.default.logining=!0,console.log("wx.login");var o=(new Date).getTime();wx.login({complete:function(){var e=(new Date).getTime();a.default.report("login",o,e)},success:function(t){t.code?function(e){var t;t="function"==typeof i.default.codeToSession.data?i.default.codeToSession.data():i.default.codeToSession.data||{};return t[i.default.codeToSession.codeName]=e,new Promise(function(e){s.default.request({url:i.default.codeToSession.url,data:t,method:i.default.codeToSession.method||"GET",isLogin:!0,report:i.default.codeToSession.report||i.default.codeToSession.url,success:function(t){return r.default.session=t,r.default.sessionIsFresh=!0,r.default.sessionExpireTime&&(r.default.sessionExpire=(new Date).getTime()+r.default.sessionExpireTime,wx.setStorage({key:i.default.sessionExpireKey,data:String(r.default.sessionExpire)})),wx.setStorage({key:i.default.sessionName,data:r.default.session}),e()},complete:function(){},fail:i.default.codeToSession.fail||null})})}(t.code).then(function(){e(),r.default.logining=!1,n.default.emit("doLoginFinished")}):(u.default.doError("登录失败","请稍后重试[code 获取失败]"),console.error(t),r.default.logining=!1,n.default.emit("doLoginFinished"))},fail:function(e){u.default.systemError(t,e),console.error(e),r.default.logining=!1,n.default.emit("doLoginFinished")}})}(e,t)}t.default=function(e,t){new Promise(function(e){if(!r.default.sessionIsFresh&&r.default.session){console.log("wx.checkSession()");var t=(new Date).getTime();wx.checkSession({success:function(){e()},fail:function(){r.default.session="",e()},complete:function(){var e=(new Date).getTime();a.default.report("checkSession",t,e)}})}else e()}).then(function(){return f(e,t)})}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(9),r=o(10),i=o(15),s=o(16),u=o(17),a=o(18),f=o(19),l={init:n.default,request:r.default,uploadFile:i.default,setSession:s.default,login:u.default,getSession:a.default,getConfig:f.default};t.default=l},function(e,t,o){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),i=o(1);t.default=function(e){var t=n({},e,r.default);if(e.sessionName)try{i.default.session=wx.getStorageSync(t.sessionName)||""}catch(e){console.error("wx.getStorageSync:fail, can not get session.")}if(e.sessionExpireKey)try{i.default.sessionExpire=wx.getStorageSync(t.sessionExpireKey)||1/0}catch(e){console.error("wx.getStorageSync:fail, can not get sessionExpire.")}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(2);t.default=function(e){n.default.request(e)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={show:function(e){wx.showToast({title:"boolean"==typeof e?"加载中":e,icon:"loading",mask:!0,duration:6e4})},hide:function(){wx.hideToast({})}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),r=o(5);t.default={get:function(e,t){if(!n.default.mockJson[e.url]&&!n.default.mockJson[e.originUrl])return console.error("mock 没有对应接口的数据"),!1;var o=n.default.mockJson[e.url]||n.default.mockJson[e.originUrl],i={data:o=JSON.parse(JSON.stringify(o)),statusCode:200};r.default(i,e,t)}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={};function r(e){return n[e]||(n[e]={waitingList:[]}),n[e]}t.default={wait:function(e,t){r(e).waitingList.push(t)},emit:function(e){for(var t=r(e),o=t.waitingList.length,n=0;n<o;n++){var i=t.waitingList.shift();"function"==typeof i&&i()}}}},function(e,t,o){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.default={setParams:function(e,t){void 0===e&&(e="");var o=e.indexOf("?"),r={};if(o>=0)for(var i=e.substr(o+1).split("&"),s=0;s<i.length;s++){var u=i[s].split("=");r[u[0]]=u[1]}r=n({},r,t);var a=Object.keys(r).map(function(e){return e+"="+encodeURI(r[e])}).join("&");return o>=0?e.substring(0,o+1)+a:e+"?"+a}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(2);t.default=function(e){n.default.uploadFile(e)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(1);t.default=function(e){n.default.session=e,n.default.sessionIsFresh=!0}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(7);t.default=function(e){return n.default(e,{})}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(1);t.default=function(){return n.default.session}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),r=o(1);t.default=function(){return{urlPerfix:n.default.urlPerfix,sessionExpireTime:r.default.sessionExpireTime,sessionExpireKey:n.default.sessionExpireKey,sessionExpire:r.default.sessionExpire}}}]);