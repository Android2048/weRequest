module.exports=function(e){function t(n){if(o[n])return o[n].exports;var c=o[n]={i:n,l:!1,exports:{}};return e[n].call(c.exports,c,c.exports,t),c.l=!0,c.exports}var o={};return t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,o,n){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t){function o(e){wx.showToast({title:"boolean"==typeof e?"加载中":e,icon:"loading",mask:!0,duration:6e4})}function n(){wx.hideToast()}e.exports={show:o,hide:n}},function(e,t,o){function n(e,t){G?setTimeout(function(){n(e,t)},500):!P&&F?(G=!0,t.count++,t._checkSessionStartTime=(new Date).getTime(),wx.checkSession({success:function(){P=!0},fail:function(){F=""},complete:function(){G=!1,t.count--,t._checkSessionEndTime=(new Date).getTime(),"function"==typeof O&&O("wx_checkSession",t._checkSessionStartTime,t._checkSessionEndTime,r),c(e,t)}})):c(e,t)}function c(e,t){F||t.isLogin?"function"==typeof e&&e():N?setTimeout(function(){c(e,t)},500):(N=!0,t.count++,t._loginStartTime=(new Date).getTime(),wx.login({complete:function(){t.count--,t._loginEndTime=(new Date).getTime(),"function"==typeof O&&O("wx_login",t._loginStartTime,t._loginEndTime,r),"function"==typeof t.complete&&0==t.count&&t.complete()},success:function(o){if(o.code){var n;n="function"==typeof x.data?x.data():x.data||{},n[x.codeName]=o.code,t.count++,p({url:x.url,data:n,method:x.method,isLogin:!0,report:x.report||x.url,success:function(t){F=t,P=!0,"function"==typeof e&&e(),wx.setStorage({key:w,data:F})},complete:function(){t.count--,"function"==typeof t.complete&&0==t.count&&t.complete(),N=!1},fail:x.fail||null})}else u(t,o),console.error(o),N=!1},fail:function(e){u(t,e),console.error(e),N=!1}}))}function i(e){return"function"==typeof e.beforeSend&&e.beforeSend(),void 0===e.reLoginLimit?e.reLoginLimit=0:e.reLoginLimit++,void 0===e.count&&(e.count=0),e.showLoading&&(T.show(e.showLoading),e.complete=function(e){return function(){T.hide(),"function"==typeof e&&e.apply(this,arguments)}}(e.complete)),e}function r(e){e.count++,e.data||(e.data={}),e.url!=x.url&&F&&(e.data[w]=F);var t={};"function"==typeof E?t=E():"object"==typeof E&&(t=E),e.data=Object.assign({},t,e.data),e.method=e.method||"GET";var o=e.url.startsWith("http")?e.url:_+e.url;if("GET"!=e.method){F&&(o.indexOf("?")>=0?o+="&"+w+"="+encodeURIComponent(F):o+="?"+w+"="+encodeURIComponent(F));for(var n in t)o.indexOf("?")>=0?o+="&"+n+"="+t[n]:o+="?"+n+"="+t[n]}e.report&&(e._reportStartTime=(new Date).getTime()),wx.request({url:o,data:e.data,method:e.method,header:e.header||{},dataType:e.dataType||"json",success:function(t){if(200==t.statusCode)if(e.report&&"function"==typeof O&&(e._reportEndTime=(new Date).getTime(),O(e.report,e._reportStartTime,e._reportEndTime,r)),e.isLogin){var o="";try{o=x.success(t.data)}catch(e){}o?e.success(o):u(e,t)}else if(S(t.data)&&e.reLoginLimit<b)F="",wx.removeStorage({key:w,complete:function(){c(function(){p(e)},e)}});else if(v(t.data)&&"function"==typeof e.success){var n=null;try{n=D(t.data)}catch(e){console.error("Function successData occur error: "+e)}e.noCacheFlash||e.success(n),(!0===e.cache||"function"==typeof e.cache&&e.cache(n))&&wx.setStorage({key:e.url,data:n})}else u(e,t);else u(e,t)},fail:function(t){u(e,t),console.error(t)},complete:function(){e.count--,"function"==typeof e.complete&&0==e.count&&e.complete()}})}function a(e){e.count++,e.formData||(e.formData={}),e.formData[w]=F;var t={};"function"==typeof E?t=E():"object"==typeof E&&(t=E),e.formData=Object.assign({},t,e.formData),e.dataType=e.dataType||"json";var o=e.url.startsWith("http")?e.url:_+e.url;F&&(o.indexOf("?")>=0?o+="&"+w+"="+F:o+="?"+w+"="+F);for(var n in t)o.indexOf("?")>=0?o+="&"+n+"="+t[n]:o+="?"+n+"="+t[n];e.report&&(e._reportStartTime=(new Date).getTime()),wx.uploadFile({url:o,filePath:e.filePath||"",name:e.name||"",formData:e.formData,success:function(t){if(200==t.statusCode&&"uploadFile:ok"==t.errMsg){if(e.report&&"function"==typeof O&&(e.endTime=(new Date).getTime(),O(e.report,e._reportStartTime,e._reportEndTime,r)),"json"==e.dataType)try{t.data=JSON.parse(t.data)}catch(o){return u(e,t),!1}S(t.data)&&e.reLoginLimit<b?(F="",wx.removeStorage({key:w,complete:function(){c(function(){d(e)},e)}})):v(t.data)&&"function"==typeof e.success?e.success(D(t.data)):u(e,t)}else u(e,t)},fail:function(t){u(e,t),console.error(t)},complete:function(){e.count--,"function"==typeof e.complete&&0==e.count&&e.complete()}})}function u(e,t){if("function"==typeof e.fail)e.fail(t);else{var o="";if("function"==typeof L)try{o=L(t.data)}catch(e){}else"string"==typeof L&&(o=L);var n="";if("function"==typeof k)try{n=k(t.data)}catch(e){}else"string"==typeof k&&(n=k);wx.showModal({title:o,content:n||"网络或服务异常，请稍后重试",showCancel:!1})}"function"==typeof C&&C(e,t),console.error(t)}function f(e,t){e.cache?wx.getStorage({key:e.url,success:function(o){"function"==typeof e.beforeSend&&e.beforeSend(),"function"==typeof e.cache&&e.cache(o.data)?"function"==typeof e.success&&e.success(o.data,{isCache:!0}):1==e.cache&&"function"==typeof e.success&&e.success(o.data,{isCache:!0}),"function"==typeof e.complete&&e.complete(),t(e)},fail:function(){e.noCacheFlash=!1,t(e)}}):t(e)}function s(e){n(e,{})}function l(e){w=e.sessionName||"session",S=e.loginTrigger||function(){return!1},x=e.codeToSession||{},v=e.successTrigger||function(){return!0},_=e.urlPerfix||"",D=e.successData||function(e){return e},L=e.errorTitle||"操作失败",k=e.errorContent||!1,b=e.reLoginLimit||3,C=e.errorCallback||null,P=e.doNotCheckSession||!1,O=e.reportCGI||!1,j=e.mockJson||!1,E=e.globalData||!1;try{F=wx.getStorageSync(w)||""}catch(e){}}function p(e){e=i(e),j&&j[e.url]?y(e):f(e,function(e){n(function(){r(e)},e)})}function d(e){e=i(e),n(function(){a(e)},e)}function m(e){F=e,P=!0}function y(e){var t={data:j[e.url]};v(t.data)&&"function"==typeof e.success?e.success(D(t.data)):u(e,t),"function"==typeof e.complete&&e.complete()}function h(){return F}function g(){return{urlPerfix:_}}const T=o(0);var w="session",S=function(){return!1},x={},v=function(){return!0},_="",D=function(e){return e},L="操作失败",k=function(e){return e},b=3,C=null,O=!1,j=!1,E=!1,F="",P=!1,N=!1,G=!1;e.exports={init:l,request:p,uploadFile:d,setSession:m,login:s,getSession:h,getConfig:g}}]);