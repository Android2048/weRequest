module.exports=function(e){var t={};function o(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},o.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=2)}([function(e,t){var o={};function n(e){return o[e]||(o[e]={waitingList:[],result:null}),o[e]}e.exports={wait:function(e,t){var o=n(e);o.result?t(o.result):o.waitingList.push(t)},emit:function(e,t){var o=n(e);o.result=t||!0,o.waitingList.forEach(function(e){e(t)}),o.waitingList.length=0}}},function(e,t){e.exports={show:function(e){wx.showToast({title:"boolean"==typeof e?"加载中":e,icon:"loading",mask:!0,duration:6e4})},hide:function(){wx.hideToast()}}},function(e,t,o){const n=o(1),i=o(0);var c="session",r=function(){return!1},a={},u=function(){return!0},s="",f=function(e){return e},l="操作失败",p=function(e){return e},d=3,m=null,h=!1,g=!1,y=!1,w="",T=!1,S=!1,x=!1;function v(e,t){x?i.wait("checkSessionFinished",function(){v(e,t)}):!T&&w?(x=!0,t.count++,t._checkSessionStartTime=(new Date).getTime(),console.log("wx.checkSession"),wx.checkSession({success:function(){T=!0},fail:function(){w=""},complete:function(){x=!1,t.count--,t._checkSessionEndTime=(new Date).getTime(),"function"==typeof h&&h("wx_checkSession",t._checkSessionStartTime,t._checkSessionEndTime,k),L(e,t),i.emit("checkSessionFinished")}})):L(e,t)}function L(e,t){w||t.isLogin?"function"==typeof e&&e():S?i.wait("doLoginFinished",function(){L(e,t)}):(S=!0,t.count++,t._loginStartTime=(new Date).getTime(),console.log("wx.login"),wx.login({complete:function(){t.count--,t._loginEndTime=(new Date).getTime(),"function"==typeof h&&h("wx_login",t._loginStartTime,t._loginEndTime,k),"function"==typeof t.complete&&0==t.count&&t.complete()},success:function(o){var n;o.code?((n="function"==typeof a.data?a.data():a.data||{})[a.codeName]=o.code,t.count++,b({url:a.url,data:n,method:a.method,isLogin:!0,report:a.report||a.url,success:function(t){w=t,T=!0,"function"==typeof e&&e(),wx.setStorage({key:c,data:w})},complete:function(){t.count--,"function"==typeof t.complete&&0==t.count&&t.complete(),S=!1,i.emit("doLoginFinished")},fail:a.fail||null})):(D(t,o),console.error(o),S=!1,i.emit("doLoginFinished"))},fail:function(e){D(t,e),console.error(e),S=!1,i.emit("doLoginFinished")}}))}function _(e){var t;return"function"==typeof e.beforeSend&&e.beforeSend(),void 0===e.reLoginLimit?e.reLoginLimit=0:e.reLoginLimit++,void 0===e.count&&(e.count=0),e.showLoading&&(n.show(e.showLoading),e.complete=(t=e.complete,function(){n.hide(),"function"==typeof t&&t.apply(this,arguments)})),e}function k(e){e.count++,e.data||(e.data={}),e.url!=a.url&&w&&(e.data[c]=w);var t={};"function"==typeof y?t=y():"object"==typeof y&&(t=y),e.data=Object.assign({},t,e.data),e.method=e.method||"GET";var o=e.url.startsWith("http")?e.url:s+e.url;if("GET"!=e.method)for(var n in w&&(o.indexOf("?")>=0?o+="&"+c+"="+encodeURIComponent(w):o+="?"+c+"="+encodeURIComponent(w)),t)o.indexOf("?")>=0?o+="&"+n+"="+t[n]:o+="?"+n+"="+t[n];e.report&&(e._reportStartTime=(new Date).getTime()),wx.request({url:o,data:e.data,method:e.method,header:e.header||{},dataType:e.dataType||"json",success:function(t){if(200==t.statusCode)if(e.report&&"function"==typeof h&&(e._reportEndTime=(new Date).getTime(),h(e.report,e._reportStartTime,e._reportEndTime,k)),e.isLogin){var o="";try{o=a.success(t.data)}catch(e){}o?e.success(o):D(e,t)}else if(r(t.data)&&e.reLoginLimit<d)w="",wx.removeStorage({key:c,complete:function(){L(function(){b(e)},e)}});else if(u(t.data)&&"function"==typeof e.success){var n=null;try{n=f(t.data)}catch(e){console.error("Function successData occur error: "+e)}e.noCacheFlash||e.success(n),(!0===e.cache||"function"==typeof e.cache&&e.cache(n))&&wx.setStorage({key:e.url,data:n})}else D(e,t);else D(e,t)},fail:function(t){D(e,t),console.error(t)},complete:function(){e.count--,"function"==typeof e.complete&&0==e.count&&e.complete()}})}function D(e,t){if("function"==typeof e.fail)e.fail(t);else{var o="";if("function"==typeof l)try{o=l(t.data)}catch(e){}else"string"==typeof l&&(o=l);var n="";if("function"==typeof p)try{n=p(t.data)}catch(e){}else"string"==typeof p&&(n=p);wx.showModal({title:o,content:n||"网络或服务异常，请稍后重试",showCancel:!1})}"function"==typeof m&&m(e,t),console.error(t)}function b(e){e=_(e),g&&g[e.url]?function(e){var t={data:g[e.url]};u(t.data)&&"function"==typeof e.success?e.success(f(t.data)):D(e,t);"function"==typeof e.complete&&e.complete()}(e):function(e,t){e.cache?wx.getStorage({key:e.url,success:function(o){"function"==typeof e.beforeSend&&e.beforeSend(),"function"==typeof e.cache&&e.cache(o.data)?"function"==typeof e.success&&e.success(o.data,{isCache:!0}):1==e.cache&&"function"==typeof e.success&&e.success(o.data,{isCache:!0}),"function"==typeof e.complete&&e.complete(),t(e)},fail:function(){e.noCacheFlash=!1,t(e)}}):t(e)}(e,function(e){v(function(){k(e)},e)})}function C(e){v(function(){!function(e){e.count++,e.formData||(e.formData={}),e.formData[c]=w;var t={};"function"==typeof y?t=y():"object"==typeof y&&(t=y),e.formData=Object.assign({},t,e.formData),e.dataType=e.dataType||"json";var o=e.url.startsWith("http")?e.url:s+e.url;for(var n in w&&(o.indexOf("?")>=0?o+="&"+c+"="+w:o+="?"+c+"="+w),t)o.indexOf("?")>=0?o+="&"+n+"="+t[n]:o+="?"+n+"="+t[n];e.report&&(e._reportStartTime=(new Date).getTime()),wx.uploadFile({url:o,filePath:e.filePath||"",name:e.name||"",formData:e.formData,success:function(t){if(200==t.statusCode&&"uploadFile:ok"==t.errMsg){if(e.report&&"function"==typeof h&&(e.endTime=(new Date).getTime(),h(e.report,e._reportStartTime,e._reportEndTime,k)),"json"==e.dataType)try{t.data=JSON.parse(t.data)}catch(o){return D(e,t),!1}r(t.data)&&e.reLoginLimit<d?(w="",wx.removeStorage({key:c,complete:function(){L(function(){C(e)},e)}})):u(t.data)&&"function"==typeof e.success?e.success(f(t.data)):D(e,t)}else D(e,t)},fail:function(t){D(e,t),console.error(t)},complete:function(){e.count--,"function"==typeof e.complete&&0==e.count&&e.complete()}})}(e)},e=_(e))}e.exports={init:function(e){c=e.sessionName||"session",r=e.loginTrigger||function(){return!1},a=e.codeToSession||{},u=e.successTrigger||function(){return!0},s=e.urlPerfix||"",f=e.successData||function(e){return e},l=e.errorTitle||"操作失败",p=e.errorContent||!1,d=e.reLoginLimit||3,m=e.errorCallback||null,T=e.doNotCheckSession||!1,h=e.reportCGI||!1,g=e.mockJson||!1,y=e.globalData||!1;try{w=wx.getStorageSync(c)||""}catch(e){}},request:b,uploadFile:C,setSession:function(e){w=e,T=!0},login:function(e){v(e,{})},getSession:function(){return w},getConfig:function(){return{urlPerfix:s}}}}]);