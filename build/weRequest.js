module.exports=function(t){function e(n){if(o[n])return o[n].exports;var c=o[n]={i:n,l:!1,exports:{}};return t[n].call(c.exports,c,c.exports,e),c.l=!0,c.exports}var o={};return e.m=t,e.c=o,e.i=function(t){return t},e.d=function(t,o,n){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e){function o(){wx.showToast({title:"加载中",icon:"loading",mask:!0,duration:6e4})}function n(){wx.hideToast()}t.exports={show:o,hide:n}},function(t,e,o){function n(t,e){F?setTimeout(function(){n(t,e)},500):!C&&E?(F=!0,e.count++,e._checkSessionStartTime=(new Date).getTime(),wx.checkSession({success:function(){C=!0},fail:function(){E=""},complete:function(){F=!1,e.count--,e._checkSessionEndTime=(new Date).getTime(),"function"==typeof b&&b("wx_checkSession",e._checkSessionStartTime,e._checkSessionEndTime,r),c(t,e)}})):c(t,e)}function c(t,e){E||e.isLogin?"function"==typeof t&&t():P?setTimeout(function(){c(t,e)},500):(P=!0,e.count++,e._loginStartTime=(new Date).getTime(),wx.login({complete:function(){e.count--,e._loginEndTime=(new Date).getTime(),"function"==typeof b&&b("wx_login",e._loginStartTime,e._loginEndTime,r),"function"==typeof e.complete&&0==e.count&&e.complete()},success:function(o){if(o.code){var n;n="function"==typeof w.data?w.data():w.data||{},n[w.codeName]=o.code,e.count++,p({url:w.url,data:n,method:w.method,isLogin:!0,report:w.report||w.url,success:function(e){E=e,C=!0,"function"==typeof t&&t(),wx.setStorage({key:h,data:E})},complete:function(){e.count--,"function"==typeof e.complete&&0==e.count&&e.complete(),P=!1},fail:w.fail||null})}else u(e,o),console.error(o),P=!1},fail:function(t){u(e,t),console.error(t),P=!1}}))}function i(t){return"function"==typeof t.beforeSend&&t.beforeSend(),void 0===t.reLoginLimit?t.reLoginLimit=0:t.reLoginLimit++,void 0===t.count&&(t.count=0),t.showLoading&&(g.show(),t.complete=function(t){return function(){g.hide(),"function"==typeof t&&t.apply(this,arguments)}}(t.complete)),t}function r(t){t.count++,t.data||(t.data={}),t.url!=w.url&&E&&(t.data[h]=E);var e={};"function"==typeof j?e=j():"object"==typeof j&&(e=j),t.data=Object.assign({},e,t.data),t.method=t.method||"GET";var o=t.url.startsWith("http")?t.url:S+t.url;if("GET"!=t.method){E&&(o.indexOf("?")>=0?o+="&"+h+"="+E:o+="?"+h+"="+E);for(var n in e)o.indexOf("?")>=0?o+="&"+n+"="+e[n]:o+="?"+n+"="+e[n]}t.report&&(t._reportStartTime=(new Date).getTime()),wx.request({url:o,data:t.data,method:t.method,header:t.header||{},dataType:t.dataType||"json",success:function(e){if(200==e.statusCode)if(t.report&&"function"==typeof b&&(t._reportEndTime=(new Date).getTime(),b(t.report,t._reportStartTime,t._reportEndTime,r)),t.isLogin){var o="";try{o=w.success(e.data)}catch(t){}o?t.success(o):u(t,e)}else if(T(e.data)&&t.reLoginLimit<k)E="",wx.removeStorage({key:h,complete:function(){c(function(){p(t)},t)}});else if(x(e.data)&&"function"==typeof t.success){var n=null;try{n=v(e.data)}catch(t){console.error("Function successData occur error: "+t)}t.success(n),(!0===t.cache||"function"==typeof t.cache&&t.cache(n))&&wx.setStorage({key:t.url,data:n})}else u(t,e);else u(t,e)},fail:function(e){u(t,e),console.error(e)},complete:function(){t.count--,"function"==typeof t.complete&&0==t.count&&t.complete()}})}function a(t){t.count++,t.formData||(t.formData={}),t.formData[h]=E;var e={};"function"==typeof j?e=j():"object"==typeof j&&(e=j),t.formData=Object.assign({},e,t.formData),t.dataType=t.dataType||"json";var o=t.url.startsWith("http")?t.url:S+t.url;E&&(o.indexOf("?")>=0?o+="&"+h+"="+E:o+="?"+h+"="+E);for(var n in e)o.indexOf("?")>=0?o+="&"+n+"="+e[n]:o+="?"+n+"="+e[n];t.report&&(t._reportStartTime=(new Date).getTime()),wx.uploadFile({url:o,filePath:t.filePath||"",name:t.name||"",formData:t.formData,success:function(e){if(200==e.statusCode&&"uploadFile:ok"==e.errMsg){if(t.report&&"function"==typeof b&&(t.endTime=(new Date).getTime(),b(t.report,t._reportStartTime,t._reportEndTime,r)),"json"==t.dataType)try{e.data=JSON.parse(e.data)}catch(o){return u(t,e),!1}T(e.data)&&t.reLoginLimit<k?(E="",wx.removeStorage({key:h,complete:function(){c(function(){d(t)},t)}})):x(e.data)&&"function"==typeof t.success?t.success(v(e.data)):u(t,e)}else u(t,e)},fail:function(e){u(t,e),console.error(e)},complete:function(){t.count--,"function"==typeof t.complete&&0==t.count&&t.complete()}})}function u(t,e){if("function"==typeof t.fail)t.fail(e);else{var o="";if("function"==typeof _)try{o=_(e.data)}catch(t){}else"string"==typeof _&&(o=_);var n="";if("function"==typeof D)try{n=D(e.data)}catch(t){}else"string"==typeof D&&(n=D);wx.showModal({title:o,content:n||"网络或服务异常，请稍后重试",showCancel:!1})}"function"==typeof L&&L(t,e),console.error(e)}function f(t,e){t.cache?wx.getStorage({key:t.url,success:function(e){"function"==typeof t.cache&&t.cache(e.data)?"function"==typeof t.success&&t.success(e.data):1==t.cache&&"function"==typeof t.success&&t.success(e.data)},fail:function(){e()}}):e()}function s(t){n(t,{})}function l(t){h=t.sessionName||"session",T=t.loginTrigger||function(){return!1},w=t.codeToSession||{},x=t.successTrigger||function(){return!0},S=t.urlPerfix||"",v=t.successData||function(t){return t},_=t.errorTitle||"操作失败",D=t.errorContent||!1,k=t.reLoginLimit||3,L=t.errorCallback||null,C=t.doNotCheckSession||!1,b=t.reportCGI||!1,O=t.mockJson||!1,j=t.globalData||!1;try{E=wx.getStorageSync(h)||""}catch(t){}}function p(t){t=i(t),O&&O[t.url]?y(t):f(t,function(){n(function(){r(t)},t)})}function d(t){t=i(t),n(function(){a(t)},t)}function m(t){E=t,C=!0}function y(t){var e={data:O[t.url]};x(e.data)&&"function"==typeof t.success?t.success(v(e.data)):u(t,e),"function"==typeof t.complete&&t.complete()}const g=o(0);var h="session",T=function(){return!1},w={},x=function(){return!0},S="",v=function(t){return t},_="操作失败",D=function(t){return t},k=3,L=null,b=!1,O=!1,j=!1,E="",C=!1,P=!1,F=!1;t.exports={init:l,request:p,uploadFile:d,setSession:m,login:s}}]);