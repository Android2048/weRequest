module.exports=function(t){function e(n){if(o[n])return o[n].exports;var c=o[n]={i:n,l:!1,exports:{}};return t[n].call(c.exports,c,c.exports,e),c.l=!0,c.exports}var o={};return e.m=t,e.c=o,e.i=function(t){return t},e.d=function(t,o,n){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e){function o(){wx.showToast({title:"加载中",icon:"loading",mask:!0,duration:6e4})}function n(){wx.hideToast()}t.exports={show:o,hide:n}},function(t,e,o){function n(t,e){C?c(t,e):(e.count++,wx.checkSession({success:function(){C=!0},fail:function(){S=""},complete:function(){e.count--,c(t,e)}}))}function c(t,e){if(!S)try{S=wx.getStorageSync(p)||""}catch(t){}S||e.isLogin?"function"==typeof t&&t():(e.count++,wx.login({complete:function(){e.count--,"function"==typeof e.complete&&0==e.count&&e.complete()},success:function(o){if(o.code){var n;n="function"==typeof h.data?h.data():h.data||{},n[h.codeName]=o.code,e.count++,f({url:h.url,data:n,method:h.method,isLogin:!0,success:function(e){S=e,C=!0,"function"==typeof t&&t(),wx.setStorage({key:p,data:S})},complete:function(){e.count--,"function"==typeof e.complete&&0==e.count&&e.complete()}})}else wx.showModal({title:"登录失败",content:"请稍后重试",showCancel:!1}),console.error(o)},fail:function(t){wx.showModal({title:"登录失败",content:t.errMsg||"请稍后重试",showCancel:!1}),console.error(t)}}))}function i(t){return"function"==typeof t.beforeSend&&t.beforeSend(),void 0===t.reLoginLimit?t.reLoginLimit=0:t.reLoginLimit++,void 0===t.count&&(t.count=0),t.showLoading&&(d.show(),t.complete=function(t){return function(){d.hide(),"function"==typeof t&&t.apply(this,arguments)}}(t.complete)),t}function u(t){t.count++,t.data||(t.data={}),t.url!=h.url&&(t.data[p]=S),t.method=t.method||"GET";var e=t.url.startsWith("http")?t.url:g+t.url;"GET"!=t.method&&(e.indexOf("?")>=0?e+="&"+p+"="+S:e+="?"+p+"="+S),wx.request({url:e,data:t.data,method:t.method,header:t.header||{},dataType:t.dataType||"json",success:function(e){if(200==e.statusCode)if(t.isLogin){var o="";try{o=h.success(e.data)}catch(t){}o?t.success(o):a(t,e)}else m(e.data)&&t.reLoginLimit<T?(S="",wx.removeStorage({key:p,complete:function(){c(function(){f(t)},t)}})):y(e.data)&&"function"==typeof t.success?t.success(w(e.data)):a(t,e);else a(t,e)},fail:function(e){wx.showModal({title:"请求失败",content:e.errMsg,showCancel:!1}),a(t,e)},complete:function(){t.count--,"function"==typeof t.complete&&0==t.count&&t.complete()}})}function r(t){t.count++,t.formData||(t.formData={}),t.formData[p]=S,t.dataType=t.dataType||"json",wx.uploadFile({url:g+t.url,filePath:t.filePath||"",name:t.name||"",formData:t.formData,success:function(e){if(200==e.statusCode&&"uploadFile:ok"==e.errMsg){if("json"==t.dataType)try{e.data=JSON.parse(e.data)}catch(o){return a(t,e),!1}m(e.data)&&t.reLoginLimit<T?(S="",wx.removeStorage({key:p,complete:function(){c(function(){l(t)},t)}})):y(e.data)&&"function"==typeof t.success?t.success(w(e.data)):a(t,e)}else a(t,e)},fail:function(e){wx.showModal({title:"请求失败",content:e.errMsg,showCancel:!1}),a(t,e)},complete:function(){t.count--,"function"==typeof t.complete&&0==t.count&&t.complete()}})}function a(t,e){if("function"==typeof t.fail)t.fail(e);else{var o="";if("function"==typeof x)try{o=x(e.data)}catch(t){}else"string"==typeof x&&(o=x);var n="";if("function"==typeof L)try{n=L(e.data)}catch(t){}else"string"==typeof L&&(n=L);wx.showModal({title:o||"操作失败",content:n||"服务器异常，请稍后重试",showCancel:!1})}"function"==typeof v&&v(t,e),console.error(e)}function s(t){p=t.sessionName||"session",m=t.loginTrigger||function(){return!1},h=Object.assign({},{method:"GET",codeName:"code"},t.codeToSession),y=t.successTrigger||function(){return!0},g=t.urlPerfix||"",w=t.successData||function(t){return t},x=t.errorTitle||"操作失败",L=t.errorContent||!1,T=t.reLoginLimit||3,v=t.errorCallback||null,C=t.doNotCheckSession||!1;try{S=wx.getStorageSync(p)||""}catch(t){}}function f(t){t=i(t),n(function(){u(t)},t)}function l(t){t=i(t),n(function(){r(t)},t)}const d=o(0);var p="session",m=function(){return!1},h={},y=function(){return!0},g="",w=function(t){return t},x="操作失败",L=function(t){return t},T=3,v=null,S="",C=!1;t.exports={init:s,request:f,uploadFile:l}}]);